<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TARS x Myles Task Bridge â€” v2</title>
  <style>
    :root{
      --bg:#070b18; --bg2:#0d1633; --card:#121b38; --line:#2b3c73; --text:#edf2ff; --muted:#9fb0dd;
      --accent:#69a7ff; --accent2:#8c6bff; --good:#28c98b; --warn:#ffb84d; --done:#24b876;
      --shadow:0 10px 30px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;color:var(--text);
      background:radial-gradient(1200px 500px at 10% -10%,#1a2c63 0%,transparent 60%),
                 radial-gradient(1000px 500px at 90% -20%,#3e2a74 0%,transparent 55%),
                 linear-gradient(180deg,var(--bg),var(--bg2));}
    .wrap{max-width:1200px;margin:22px auto;padding:0 16px}
    .header{display:flex;justify-content:space-between;align-items:end;gap:12px;flex-wrap:wrap}
    h1{margin:0;font-size:1.32rem;letter-spacing:.2px}
    .sub{margin:6px 0 0;color:var(--muted);font-size:.95rem}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:5px 10px;border:1px solid var(--line);border-radius:999px;background:#0e1733;color:var(--muted);font-size:.8rem}

    .grid{display:grid;grid-template-columns:1.1fr .95fr;gap:16px;margin-top:14px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,#101a38,#0f1732);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
    .card h2{margin:0 0 10px;font-size:1.03rem}

    .row{display:flex;gap:8px;flex-wrap:wrap}
    input,textarea,select,button{border:1px solid #344b8f;background:#0f1734;color:var(--text);border-radius:11px;padding:10px}
    input,textarea,select{width:100%}
    textarea{min-height:86px;resize:vertical}
    button{cursor:pointer;transition:.12s ease}
    button:hover{filter:brightness(1.1)}
    .primary{background:linear-gradient(180deg,#2f67ec,#2a56cf);border-color:#4d79e9}
    .ghost{background:#121c3d}

    .task{display:grid;grid-template-columns:1fr auto;gap:10px;padding:11px;border:1px solid #324580;border-radius:12px;margin-top:8px;background:rgba(255,255,255,.01)}
    .task .title{font-weight:650}
    .meta{font-size:.78rem;color:var(--muted)}
    .status{font-size:.74rem;border-radius:999px;padding:4px 8px;display:inline-block}
    .todo{background:#2a365f}.doing{background:#5f4a1f}.done{background:#1b5940}
    .empty{color:var(--muted);font-size:.9rem;padding:8px 0}

    .msg{padding:10px;border:1px solid #364983;border-radius:11px;margin-top:8px;background:rgba(255,255,255,.01)}
    .msg.me{border-color:#4c6fdb}.msg.tars{border-color:#2d9d70}
    .history-item{padding:9px;border:1px dashed #3f5390;border-radius:10px;margin-top:8px;font-size:.9rem}

    .stack{display:grid;gap:12px}
    .footer{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-top:10px;color:var(--muted);font-size:.8rem}
    .tiny{font-size:.78rem;color:var(--muted)}
    .counter{font-size:.78rem;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div>
        <h1>ðŸ¤– TARS x Myles â€” Task Bridge <span class="pill">v2 â€¢ polished UI + history</span></h1>
        <p class="sub">Shared board for tasks, notes, and action history. Data persists in your browser (localStorage).</p>
      </div>
      <div class="pill" id="stats">0 tasks â€¢ 0 notes â€¢ 0 history</div>
    </div>

    <div class="grid">
      <section class="card">
        <h2>Tasks</h2>
        <div class="row">
          <input id="taskTitle" placeholder="Task title (e.g., Test risklo results)" />
          <select id="taskStatus">
            <option value="todo">To Do</option>
            <option value="doing">In Progress</option>
            <option value="done">Done</option>
          </select>
          <input id="taskDue" placeholder="Due (optional, ET)" />
          <button class="primary" id="addTask">Add Task</button>
        </div>
        <div id="tasks"></div>
      </section>

      <div class="stack">
        <section class="card">
          <h2>Notes / Handoff</h2>
          <div class="row">
            <select id="author"><option value="Myles">Myles</option><option value="TARS">TARS</option></select>
            <textarea id="noteText" placeholder="Drop updates, blockers, or instructions..."></textarea>
            <button class="primary" id="addNote">Post Note</button>
          </div>
          <div id="notes"></div>
        </section>

        <section class="card">
          <h2>History</h2>
          <div class="row">
            <select id="historyFilter">
              <option value="all">All actions</option>
              <option value="task">Task actions</option>
              <option value="note">Note actions</option>
              <option value="system">System actions</option>
            </select>
            <button id="clearHistory" class="ghost">Clear History</button>
          </div>
          <div id="history"></div>
          <div class="counter" id="historyCount"></div>
        </section>

        <section class="card">
          <div class="footer">
            <div class="tiny">Tip: Export JSON and send it to TARS for parsing or backup.</div>
            <div class="row">
              <button id="exportBtn">Export</button>
              <button id="clearBtn" class="ghost">Clear Board</button>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

<script>
const KEY='tars-task-bridge-v2';
const old=JSON.parse(localStorage.getItem('tars-task-bridge-v1')||'null');
const initial=JSON.parse(localStorage.getItem(KEY)||'null') || (old?{tasks:old.tasks||[],notes:old.notes||[],history:[]}: {tasks:[],notes:[],history:[]});
const state={tasks:initial.tasks||[],notes:initial.notes||[],history:initial.history||[]};
const $=s=>document.querySelector(s);
const fmt=t=>new Date(t).toLocaleString();
const esc=s=>(s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));

function log(type,text){ state.history.push({type,text,ts:Date.now()}); if(state.history.length>300) state.history=state.history.slice(-300); }
function save(){ localStorage.setItem(KEY,JSON.stringify(state)); render(); }

function taskStatusTag(s){return `<span class="status ${s}">${s.toUpperCase()}</span>`}
function render(){
  $('#tasks').innerHTML = state.tasks.length? state.tasks.map((t,i)=>`<div class="task"><div><div class="title">${esc(t.title)}</div><div class="meta">Due: ${esc(t.due||'â€”')} â€¢ Created ${fmt(t.createdAt||t.ts)} â€¢ Updated ${fmt(t.updatedAt||t.ts)}</div></div><div>${taskStatusTag(t.status)}<div class="row" style="margin-top:6px"><button onclick="cycleTask(${i})">Next</button><button onclick="deleteTask(${i})">Delete</button></div></div></div>`).join('') : `<div class="empty">No tasks yet.</div>`;

  $('#notes').innerHTML = state.notes.length? state.notes.slice().reverse().map(n=>`<div class="msg ${n.author==='TARS'?'tars':'me'}"><strong>${esc(n.author)}</strong><div>${esc(n.text)}</div><div class="meta">${fmt(n.ts)}</div></div>`).join('') : `<div class="empty">No notes yet.</div>`;

  const f=$('#historyFilter').value;
  const rows=state.history.slice().reverse().filter(h=>f==='all'||h.type===f);
  $('#history').innerHTML = rows.length? rows.map(h=>`<div class="history-item"><strong>${h.type.toUpperCase()}</strong> â€¢ ${esc(h.text)}<div class="meta">${fmt(h.ts)}</div></div>`).join('') : `<div class="empty">No history yet.</div>`;
  $('#historyCount').textContent=`Showing ${rows.length} / ${state.history.length} events`;

  $('#stats').textContent=`${state.tasks.length} tasks â€¢ ${state.notes.length} notes â€¢ ${state.history.length} history`;
}

window.cycleTask=(i)=>{
  const order=['todo','doing','done'];
  const t=state.tasks[i];
  const prev=t.status;
  t.status=order[(order.indexOf(t.status)+1)%3];
  t.updatedAt=Date.now();
  log('task',`Status changed: "${t.title}" (${prev} â†’ ${t.status})`);
  save();
}
window.deleteTask=(i)=>{
  const t=state.tasks[i];
  state.tasks.splice(i,1);
  log('task',`Deleted task: "${t.title}"`);
  save();
}

$('#addTask').onclick=()=>{
  const title=$('#taskTitle').value.trim(); if(!title) return;
  const now=Date.now();
  state.tasks.push({title,status:$('#taskStatus').value,due:$('#taskDue').value.trim(),createdAt:now,updatedAt:now,ts:now});
  log('task',`Added task: "${title}"`);
  $('#taskTitle').value=''; $('#taskDue').value=''; save();
}
$('#addNote').onclick=()=>{
  const text=$('#noteText').value.trim(); if(!text) return;
  const author=$('#author').value;
  state.notes.push({author,text,ts:Date.now()});
  log('note',`${author} posted a note`);
  $('#noteText').value=''; save();
}
$('#historyFilter').onchange=render;
$('#clearHistory').onclick=()=>{ if(confirm('Clear action history?')){state.history=[]; log('system','History cleared'); save();} }
$('#clearBtn').onclick=()=>{ if(confirm('Clear all tasks and notes?')){state.tasks=[]; state.notes=[]; log('system','Board cleared (tasks + notes)'); save();} }
$('#exportBtn').onclick=()=>{
  const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='task-bridge-v2.json'; a.click();
  URL.revokeObjectURL(a.href); log('system','Exported board JSON'); save();
}

if(!localStorage.getItem(KEY) && old){ log('system','Migrated data from v1 storage'); save(); } else { render(); }
</script>
</body>
</html>